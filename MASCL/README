# Step-by-Step Instructions for the MASCL Protocol

1. Reduced P43212 and P41212 Subsets

All PDB entries of single-chain human proteins with space groups P43212 and P41212 (extracted from the 16,123 SCHP dataset; see Dataset section) were clustered and filtered to maintain <70% sequence identity. The resulting subsets of similarity-reduced P43212 and P41212 samples are listed in: "P43212_Reduced_Sample.xlsx" and "P41212_Reduced_Sample.xlsx".

2. MASCL Protocol

This protocol employs two strategies for generating pairwise assemblies: (1) AlphaFold3 (AF3) and (2) AlphaFold2 (AF2) + C2-DIPER.

Because these approaches use different naming conventions and file formats, the instructions below provide two separate workflows to generate the minimal protein crystal packing (MPCP) model. While most steps are similar for P43212 and P41212, we demonstrate the procedure for P43212 with the example 1iat.pdb. The user can apply the same process to P41212 (e.g., 5cg5.pdb).

** Requirement
Please download the PIPER docking software. It is available free of charge to academic users upon registration at the ClusPro website (https://cluspro.org/downloads.php).

- 2.1 AlphaFold3 (AF3)

(0) Download Ground Truth PDB Files
Place the original PDB files you intend to process in a folder named "PDB". These files will be used at each step to generate the actual crystal packing and to calculate model accuracy.

(1) Generate Pairwise Assemblies via AF3
- Use the online AF3 Server Beta to create crystallographic pairwise models for your P41212 or P43212 targets by providing the sequence(s) from each PDB file, setting "auto random seed", and specifying "molecular copy number = 2."
- Five AF3 crystallographic pairwise models will be generated per target, ranked by the AF3 scoring system.
- Example (P43212, 1iat)
After submitting the 1iat sequence to AF3, you will receive five pairwise assemblies, named "fold_1iat_model_0.cif, fold_1iat_model_1.cif, ..., fold_1iat_model_4.cif", saved in a "fold_1iat" folder.

(2) File Conversion and Preprocessing
- Convert each .cif file to .pdb format (e.g., using PyMOL: save model_0.pdb, fold_1iat_model_0.cif).
- Compile the list of target PDB entries in a text file named "target_entry.txt".
- Run the script "AF3M_Preprocessing.m" to remove low-confidence regions from each model. The truncated AF model files will be stored in "AF3_trun_Dimer/[target_entry]".
- Example (P43212, fold_1iat_model_0.cif)
Convert "fold_1iat_model_0.cif" to "model_0.pdb". Then, execute "AF3M_Preprocessing.m" to obtain the truncated model "1iat_trun_AF_model_0.pdb", located in "AF3_trun_Dimer/1iat".

(3) 2-Fold Symmetry Examination
- List all target PDB entries in a text file named "target_entry.txt".
- Run "AF3_Pairewise_Assembly_P43212.m" or "AF3_Pairewise_Assembly_P41212.m" (depending on the space group) to check for 2-fold symmetry and rank potential docking poses.
- Output files are stored in "AF3_Dimer_Result/[target_entry]", including up to five pairwise assemblies that satisfy space-group constraints, named "[pdb_entry]_trun_AF_model_X.pdb" (where X is the model index).
- A corresponding "*_Ans.pdb" file representing the ground truth pairwise assembly extracted from the actual PDB structure is also outputted in the same folder, enabling RMSD and DockQ comparisons.
- Example (P43212, 1iat_trun_AF_model_0.pdb)
With 1iat listed in "target_entry.txt", run "AF3_Pairewise_Assembly_P43212.m". Outputs will appear in "AF3_Dimer_Result/1iat", including "1iat_trun_AF_model_0.pdb (predicted pairwise model)" and "1iat_trun_AF_model_0_Ans.pdb (ground-truth pairwise assembly)".

(4) C4-DIPER Docking for Tetrameric Complex Generation
- A helper script "PIPER_Script.m" is provided to generate the necessary input files for PIPER.
- List your target PDB entries in "target_entry.txt" and run "PIPER_Script.m".
- Use PIPER program to perform docking with 4-fold symmetry constraints. Please replace the default PIPER parameters with the 4-fold symmetry parameter files: "C4_rots.prm", "Coeff_DIPER.prm", and "atoms.prm" (located in the "PIPER_Package" folder).
- PIPER outputs a file (default name "ft.000.00") containing rotation and translation matrices for the proposed tetrameric assembly.
- Example (P43212, 1iat_trun_AF_model_0.pdb)
For "1iat_trun_AF_model_0.pdb", run "Sample_prep_1iat.m" and "Sample_PIPER_1iat.txt" (generated by "PIPER_Script.m"). The docking result is saved in "AF3_Dimer4Docking/[1iat_trun_AF_model_0]/ft.000.00".

(5) 4-Fold Symmetry Examination
- Run "AF3_C4.DIPER_P43212.m" or "AF3_C4.DIPER_P41212.m" (depending on the space group) to check 4-fold symmetry.
- Output files are placed in "AF3_C4.DIPER_Result/[target_entry]".
- Up to 300 tetrameric assemblies that meet space-group constraints are generated, each named "[pdb_entry].trun_AF_model_0.000.AAA.pdb" (where AAA is a rotation matrix index from "ft.000.00").
- A corresponding "*_Ans.pdb" file serveing as the ground-truth tetrameric assembly is also outputted in the same folder, used for RMSD and PackQ calculations.
- Example (P43212, 1iat_trun_AF_model_0.pdb)
1iat.000.1.000.19.pdb is the predicted tetrameric assembly, and 1iat.000.1.000.19_Ans.pdb is the ground truth.

(6) Local Docking Refinement
- Run "AF3_SurfOrca_P43212.m" or "AF3_SurfOrca_P41212.m" (depending on the space group) to perform local docking refinements.
- Refined tetrameric models are saved in "AF3_SurfOrca_Result", named "[pdb_entry].000.XXX.000.AAA_Refined.pdb". This step resolves potential atomic clashes after constructing the crystal packing.
- Example (P43212, 1iat.000.1.000.19.pdb)
"1iat.000.1.000.19.pdb" is refined to "1iat.000.1.000.19_Refined.pdb".

(7) MPCP Construction
- Run "AF3_MPCP_P43212.m" or "AF3_MPCP_P41212.m" (depending on the space group) to build the Minimal Protein Crystal Packing (MPCP) models.
- Output files appear in "AF3_MPCP_Result", including: (1) the final minimal crystal packing model named "[pdb_entry].000.XXX.000.AAA_Sim_Packing" (the predicted packing) and (2) one named "[pdb_entry].000.XXX.000.AAA_Xtal_Packing" (the actual crystal packing extracted from the original PDB, for accuracy evaluation).
- Example (P43212, 1iat.000.1.000.19.pdb)
"1iat.000.1.000.19_Sim_Packing.pdb" (predicted packing) and "1iat.000.1.000.19_Xtal_Packing.pdb" (ground-truth packing)

** Note
- The final model rankings can be found in: "AF3_Dimer4Docking/P43212_TopRank_Result.mat" (for P43212) and 
"AF3_Dimer4Docking/P41212_TopRank_Result.mat" (for P41212). Open the .mat file and navigate to "Result.Linear_Table". If the values in column 1, 2, and 3 are A, B, and C, it indicates that the model named "[pdb_entry].000.[B-1].000.C_Sim_Packing.pdb" is ranked A among up to 300 generated MPCPs.
- If all scripts are run in the same directory, you can execute them sequentially. Otherwise, ensure each generated .pdb or .mat file is placed in the correct input paths specified within the scripts.



- 2.2 AlphaFold2 (AF2) + C2-DIPER

(0) Download Ground Truth PDB Files
Place the original PDB files you intend to process in a folder named "PDB". These files will be used at each step to generate the actual crystal packing and to calculate model accuracy.

(1) AF2 Structure Download and Preprocessing
- Add the PDB entries you want to process to target_entry.txt.
- Run the script "PDBID2AF_V3.m", which retrieves the corresponding AF2 structures based on the sequences in the PDB files. Low-confidence regions—defined as five or more consecutive residues with an average pLDDT score below 70—are removed to create AF2-truncated monomeric models. 
- These truncated models are outputted as "[pdb_entry]_trun_AF.pdb" for improved docking performance in subsequent C2-DIPER steps.
- Example (P43212, 1iat)
The output file would be "1iat_trun_AF.pdb".

(2) C2-DIPER Docking for Pairwise Assembly Generation
- A helper script "C2.PIPER_Script.m" is provided to generate input scripts for PIPER.
- List your target PDB entries in "target_entry.txt" and run "C2.PIPER_Script.m".
- Use PIPER program to perform 2-fold symmetry docking. Please replace the default PIPER parameters with the 2-fold symmetry parameter files: "C2_rots.prm", "Coeff_DIPER.prm", and "atoms.prm". All required subfunctions and parameter files are in the "PIPER_Package" folder.
- After docking completes, the output is a text file (default name "ft.000.00") containing the rotation and translation matrices for the generated poses. By default, this file is in "C2.DIPER_Result/[target_entry]".
- Example (P43212, 1iat)
After running PIPER on "1iat_trun_AF.pdb", you can find "ft.000.00" in "C2.DIPER_Result/1iat/".

(3) 2-Fold Symmetry Examination
- List your target PDB entries in "target_entry.txt".
- Run "C2.DIPER.m", which examines 2-fold symmetry and ranks the resulting docking poses.
- The script outputs files in "C2.DIPER_Result/C2.Top25/[target_entry]", including up to 25 pairwise assemblies that satisfy the space-group constraints. Each pairwise assembly is named "[pdb_entry].000.XXX.pdb", where XXX corresponds to the rotation matrix index from "ft.000.00".
- A corresponding "*_Ans.pdb file" representing the ground-truth pairwise assembly is also outputted in the same folder (extracted from the actual PDB data), used for RMSD and DockQ comparisons.
- Example (P43212, 1iat)
The output filenames could be 1iat.000.1.pdb and 1iat.000.1_Ans.pdb.

(4) C4-DIPER Docking for Tetrameric Complex Generation
- A helper script, "C4.PIPER_Script.m", can be used to generate the input files for PIPER.
- List your target PDB entries in "target_entry.txt" and run "C4.PIPER_Script.m".
- Use PIPER program for 4-fold symmetry docking. Please replace the default parameter files with "C4_rots.prm", "Coeff_DIPER.prm", and "atoms.prm". All required subfunctions and parameter files are in the "PIPER_Package" folder.
- After docking, PIPER outputs a file named "ft.000.00" by default, located in "C4.DIPER_Result/[target_entry_folder]".
- Example (P43212, 1iat.000.1.pdb)
After processing "1iat.000.1.pdb" with PIPER, the file "ft.000.00" is found in "C4.DIPER_Result/1iat.000.1/".

(5)  4-Fold Symmetry Examination
- Run "C4.DIPER_P43212.m" or "C4.DIPER_P41212.m" (depending on the space group) to examine 4-fold symmetry.
- Output files are placed in "C4.DIPER_Result/TopRank_300_Pose/[target_entry]".
- Up to 300 tetrameric assemblies satisfying the space-group constraints may be generated. Each assembly is named "[pdb_entry].000.XXX.000.AAA.pdb". XXX refers to the rotation matrix index from the 2-fold docking step. AAA refers to the rotation matrix index from the 4-fold docking step.
- A corresponding "*_Ans.pdb" file serveing as the ground-truth tetrameric assembly is also outputted in the same folder, used for RMSD and PackQ calculations.
- Example (P43212, 1iat.000.1.pdb)
A predicted tetrameric assembly might be "1iat.000.1.000.19.pdb", with the ground-truth version named "1iat.000.1.000.19_Ans.pdb".

(6) Local Docking for Model Refinement
- Run "SurfOrca_P43212.m" or "SurfOrca_P41212.m" (depending on the space group) to perform local docking refinements, reducing atomic clashes.
- The refined tetrameric assemblies are placed in "AF3_SurfOrca_Result", named "[pdb_entry].000.XXX.000.AAA_Refined.pdb".
- Example (P43212, 1iat.000.1.000.19.pdb)
The file "1iat.000.1.000.19.pdb" is refined to "1iat.000.1.000.19_Refined.pdb".

(7) MPCP Construction
- Run "MPCP_P43212.m" or" MPCP_P41212.m" (depending on the space group) to build the Minimal Protein Crystal Packing (MPCP) models.
- The script outputs are placed in "MPCP_Result/Packing_Poses/[target_entry]", including: (1) the final minimal crystal packing model named "[pdb_entry].000.XXX.000.AAA_Sim_Packing.pdb", and (2) one named "[pdb_entry].000.XXX.000.AAA_Xtal_Packing" (the actual crystal packing extracted from the original PDB, for accuracy evaluation).
- Example (P43212, 1iat.000.1.000.19.pdb)
From "1iat.000.1.000.19.pdb", you may see "1iat.000.1.000.19_Sim_Packing.pdb" (predicted) and "1iat.000.1.000.19_Xtal_Packing.pdb" (ground truth)


** Note
- The final model rankings can be found in: "C4.DIPER_Result/P43212_TopRank_Result.mat" (for P43212) and 
"C4.DIPER_Result/P41212_TopRank_Result.mat (for P41212)". Open the .mat file and navigate to "Result.Linear_Table". If the values in column 1 and 4 are A and B, it indicates that the model named "[pdb_entry].000.x.000.B_Sim_Packing.pdb" is ranked A among up to 300 generated MPCPs.
- If all scripts are run in the same directory, you can execute them sequentially. Otherwise, ensure each generated .pdb or .mat file is placed in the correct input paths specified within the scripts.
